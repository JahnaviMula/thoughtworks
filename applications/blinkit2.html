<!DOCTYPE html>

<head>
    <style>
        h1,
        h5 {
            font-family: Arial, Helvetica, sans-serif;
        }

        .display_items {
            border: 2px solid rgb(182, 166, 166);
            border-radius: 10%;
            width: 220px;
            height: 250px;
            margin: 4px;
            text-align: center;

        }

        .display_image {
            display: inline-block;
            width: 150px;
            height: 150px;
        }

        .cart {
            background-color: green;
            color: white;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .display_items:hover {
            background-color: rgba(209, 181, 181, 0.233);
        }

        #dec,
        #inc {
            background-color: black;
            color: white;
            width: 20px;
            height: 20px;
            margin: 10px;
            border-radius: 100%;
        }

        .layout {
            width: 100%;
        }

        .layout .d1 {
            display: inline-block;
            vertical-align: top;
            width: 60%;
        }

        .layout .d2 {
            display: inline-block;
            width: 20%;
        }

        .layout .d3 {
            width: 100px;
            height: 100px;
            background-color: beige;
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="layout">
        <div class="d1">
            <h1>Point of Scale</h1>
            <div id="container"></div>
        </div>
        <div class="d2">
            <h1>Cart<span id="selected_items">0</span></h1>
            <table border="1" id="table_items">
                <tr>
                    <th>Tittle</th>
                    <th>price</th>
                    <th>Qunatity</th>
                    <th>Total price</th>
                </tr>
            </table>
        </div>
        <div class="d3"></div>
    </div>
    <script>
        var c = 0
        var products = []
        var cartItems = []
        var http = new XMLHttpRequest()
        http.open("GET", "https://dummyjson.com/products?limit=5&skip=15")
        http.send()
        http.onload = function () {
            var data = JSON.parse(http.responseText);
            products = data.products;
            products = products.map(product => ({
                ...product,
                quantity: 0
            }));
            display_items()
        }
        function display_items() {
            products.forEach(function (item, index) {
                var box = document.createElement("div")
                let pic = document.createElement("img")
                pic.src = item.thumbnail
                pic.classList.add("display_image")
                box.appendChild(pic)
                let item_name = document.createElement("h5")
                item_name.innerText = item.title
                box.appendChild(item_name)
                let cost = document.createElement("p")
                cost.innerText = item.price
                box.appendChild(cost)
                let btn = document.createElement("button")
                btn.innerText = "ADD TO CART"
                btn.classList.add("cart")
                box.appendChild(btn)
                box.classList.add("display_items")
                document.getElementById("container").appendChild(box)
                btn.addEventListener("click", function () {
                    cart_data(index)
                    changeQuantity(btn, index)
                })
            })
        }

        function cart_data(index) {
            let item = products[index]
            item.quantity = 1
            var ntr = document.createElement("tr")
            var product_name = document.createElement("td")
            product_name.innerText = item.title
            ntr.appendChild(product_name)
            var product_price = document.createElement("td")
            product_price.innerText = item.price
            ntr.appendChild(product_price)
            var items = document.createElement("td")
            items.innerText = item.quantity
            ntr.appendChild(items)
            var price = document.createElement("td")
            price.innerText = item.price * item.quantity
            ntr.appendChild(price)
            document.getElementById("table_items").appendChild(ntr)
            var obj = {
                name: item.title,
                bill: Number(item.price),
                quantity: item.quantity,
            }
            cartItems.push(obj)
            document.getElementById("selected_items").innerText = cartItems.length


        }

        function changeQuantity(btn, index) {
            let item = products[index]
            var nli = document.createElement("li")
            let dec_button = document.createElement("button")
            dec_button.innerText = "-"
            dec_button.id = "dec"
            dec_button.disabled = false;
            nli.appendChild(dec_button)
            let no_items = document.createElement("span")
            no_items.innerText = 1
            nli.appendChild(no_items)
            let inc_button = document.createElement("button")
            inc_button.innerText = "+"
            inc_button.id = "inc"
            nli.appendChild(inc_button)
            btn.replaceWith(nli)
            dec_button.addEventListener("click", function () {
                if (item.quantity == 0) {
                    dec_button.disabled = true
                }
                else {
                    no_items.innerText = --item.quantity
                    update_object_table(item)
                }
            })
            inc_button.addEventListener("click", function () {
                no_items.innerText = ++item.quantity
                update_object_table(item)
                if (y > 1) {
                    dec_button.disabled = false
                }
            })
        }

        function update_object_table(item) {
            var updateAmount = item.quantity * item.price
            let rows = document.querySelectorAll("#table_items tr");
            rows.forEach(function (row) {
                if (row.cells[0].innerText === item.title) {
                    row.cells[2].innerText = item.quantity;
                    row.cells[3].innerText = updateAmount;
                }
            });
        }
    </script>
</body>

</html>